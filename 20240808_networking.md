##### 《计算机网络 自顶层向下方法》笔记
###### 第1章 计算机网络和英特网
因特网：因特网是一个互联了众多计算设备的网络。这些计算设备统称为主机也叫端系统，构成计算机网络的边缘部分。端系统分为客户、服务器。大型数据中心是众多服务器的结合。端系统通过通信链路和分组交换机互联通信。  

通信链路：通信链路由不同类型的物理媒体组成，具有不同的传输速率。最常见的物理媒体包括同轴电缆、铜线、光纤、无线电频谱。  

分组交换机：分组交换机分为路由器和链路交换机，路由器通常位于网络核心中，链路交换机通常位于接入网中。端系统将数据分段成为分组，交由分组交换机转发。  

接入网：接入网将端系统连接到边缘路由器，边缘路由器是端系统到任何其他端系统的第一台路由器。接入网分成家庭接入、企业接入、广域无线接入。宽带接入最常见的是用户数字线DSL和电缆。  

用户数字线DSL接入：众多DSL与一个分配器相连，通过电话线即双绞铜线与电话公司本地中心局CO的一个DSL接入复用器DSLAM相连，再连接到因特网。电话线同时承载了电话和数据信号。DSL调制解调器将数字数据转化为高频音，DSLAM将模拟信号转换为数字形式。在本地中心局，DSLAM把数据和电话信号分开；在用户端，分配器把数据和电话信号分开。
高速下行信道：50kHz~1MHz频段；
中速上行信道：4kHz~50kHz频段；
普通双向电话信道：0~4kHz频段。
DSL标准定义了多个传输速率，包括12Mbps下行，1.8Mbps上行；55Mbps下行，15Mbps上行，称为不对称接入。实际上下行传输速率更小。住在本地中心局5~10英里分为内适合采用用户数字线DSL接入。1英里~=1609.344米。  

电缆接入：DSL利用本地电话基础设施，电缆利用有限电视基础设施，这个系统常被称为混合光纤同轴HFC系统。500~5000个家庭通过同轴电缆相连构成一个地区枢纽，地区枢纽由光缆连接到电缆头端，再连接到因特网。电缆调制解调器如同DSL调制解调器，将HFC网路分为下行和上行两个信道，是不对称的，下行分配速率通常比上行高，如42.8Mbps下行，30.7Mbps上行，实际传输速率更小；电缆调制解调器端接系统CMTS如同DSLAM，将模拟信号转为数字形式。电缆接入网共享广播媒体。  

光纤到户FTTH：光纤到户FTTH是比DSL和电缆更高速的接入技术，从本地中心局直接到家庭，提供每秒千兆比特范围的因特网接入速率。光纤分布体系结构分为主动光纤网络AON和被动光纤网络PON，AON本质上是交换因特网。  

被动光纤网络PON：用户路由器与光纤网络端接器ONT相连，ONT由光纤连接到分配器，再连接到本地电话公司中心局的光纤线路端接器OLT。OLT提供光电信号的转换，通过电话公司路由器与因特网相连。  

卫星和拨号：在无法提供DSL、电缆和FTTH的乡村环境，可以使用卫星链路与因特网相连。电话线拨号接入与DSL的模式相同，家庭的调制解调器通过电话线连接到ISP的调制解调器，但速率很慢。  

企业接入：以太网接入，用户使用双绞铜线与以太网交换机相连，以太网交换机再与因特网相连。用户常以100Mbps或1Gbps速率接入以太网交换机，服务器可有1Gbps~10Gbps的接入速率。无线局域网LAN，用户要求位于接入点数十米范围内，接入点与企业网相连，企业网再与有线因特网相连，无线接入技术俗称WiFi。以太网和WiFi接入网最初用于企业，后来发展到户，许多家庭将宽带住宅接入即DSL或电缆与无线局域网技术结合，组成更强大的家用网络。  

广域网接入：移动设备如iPhone、安卓等通过蜂窝网提供商运营的基站来发送和接收分组，用户仅需位于基站的数万米范围内。第三代无线技术3G为分组交换广域无线因特网接入提供了超过1Mbps的速率。长期演进LTE来源于3G技术，能够取得超过10Mbps的速率。  

物理媒体：物理媒体分为导引型媒体和非导引型媒体。导引型媒体，电波沿着固体媒体前行，如光缆、双绞线、同轴电缆。非导引型媒体，电波在空气或外层空间中传播，如无线局域网、数字卫星频道。成本上，物理链路通常小于其他网络成本，安装物理链路劳动力的成本小于其材料成本。  

双绞铜线：双绞铜线最初用于电话网。无屏蔽双绞线UTP常用于局域网LAN，速率达10Mbps~10Gbps，取决于线粗细以及接收方和传输方的距离。  

同轴电缆：由同心结构的铜导体组成，普遍用于电视系统中，能够被用作导引型共享媒体。  

光纤：能够引导光脉冲，每个脉冲表示一个比特，光线支持极高的比特速率，不受电磁干扰，光缆信号衰减低，难被窃听，这些特征使得光纤成为长途导引型传输媒体，在跨海链路、长途电话中广泛应用，而家庭接入网和LAN中不适用。光载波OC标准链路速率的范围51.8Mbps~39.8Gbps，这些标准称为OC-n，链路速率为n*51.8Mbps，目前有OC-1、OC-3、OC-12、OC-24、OC-48、OC-96、OC-192、OC-768。  

陆地无线电信道：无线电信道分为三类，一类在1~2米短距离，二类运行在数十到百米的局域，三类运行在数万米的广域。个人设备短距离，无线LAN技术使用了局域无线电信道，蜂窝接入技术使用了广域无线电信道。  

卫星无线电信道：通常使用同步卫星和近地轨道LEO卫星。同步卫星相对静止于地球上空上36000km的轨道，从地面站到卫星往返提供280ms信号传播时延。近地卫星距离地表很近，围绕地球旋转，需要多个近地卫星实现覆盖区域通信。  

因特网服务提供商ISP：包括住宅、公司、大学ISP；提供Wifi接入的ISP；提供移动接入的蜂窝数据ISP；ISP是由多台分组交换机和多段通信链路组成的网络。ISP为端系统提供因特网接入服务，包括住宅宽带接入、高速局域网接入、移动无线接入。ISP也为内容提供商提供因特网接入服务，包括Web站点和视频服务器接入。低层ISP通过高层ISP互联，高层ISP由通过高速光纤链路互联的高速路由器组成。ISP各层独立管理，运行着IP协议，遵循明明和地址规则。  

协议：端系统、分组交换机及其他因特网部件都要运行协议，控制信息在因特网中的接收和发送。传输控制协议TCP、网际协议IP最为重要，因特网的主要协议统称为TCP/IP。  

请求评论RFC：RFC是一种因特网标准，因特网标准由因特网工程任务组IETF研发，IETF的标准文档就是RFC。RFC定义了TCP、IP、HTTP、SMTP等协议，RFC是为了解决网络、协议问题。  

分布式应用程序：应用程序的运行涉及多个相互交换数据的端系统，被称为分布式应用程序。分布式应用程序不会运行在网络核心的分组交换机中，分组交换机只用于加速端系统的数据交换。  

套接字接口：套接字接口规定了一个应用程序请求因特网基础设施向另一个端系统应用程序交付数据的方式，套接字接口是发送程序必须遵循的规则集合，因此因特网能够将数据交付给目的地。  

分组交换：端系统彼此交换报文，报文可以执行控制功能或包含数据。源向目的发送的报文通常会分组，每个分组通过分组交换机转发，分组交换机包括路由器和链路交换机。  

存储转发传输：分组交换机需要先接受并存储整个分组，才能开始转发第一个比特。同理，需要完成转发一个分组，才能继续接收下一个分组。  

源向目的发送一个分组：  
源向目的发送L比特的分组，链路传输速率为R比特/秒，则该分组的传输时间为L/R秒。  
源向目的经路由器存储转发一个分组：  
L/R秒，分组从源到达路由器；2L/R秒，分组从路由器到达目的。如果路由器不存储，则只需L/R秒。  
源向目的经路由器发送三个分组：  
L/R秒，第一个分组到达路由器；2L/R秒，第二个分组到达路由器，第一个分组到达目的；3L/R，第三个分组到达路由器，第二个分组到达目的；4L/R，第三个分组到达目的。  
源向目的发送一个分组，经N-1个路由器：  
代表经N条链路，端到端时延为N(L/R)秒。  
源向目的发送P个分组，经N-1个路由器：  
代表经N条链路，端到端时延为(N+P-1)(L/R)  

排队时延：分组交换机的输出缓存也叫输出队列，用于存储将要转发的分组。当路由器正在转发当前分组时，将要转发的分组就要在输出队列中等待，产生排队时延。当缓存队列的空间占满，将出现分组丢失也叫丢包。  

转发表：每个端系统具有IP地址，源发送的分组首部包含了目的的IP地址，路由器的转发表能将分组的目的IP地址映射成输出链路。分组到达路由器时，路由器检查分组的目的IP地址，搜索转发表，发现出链路，然后将分组从该出链路导出。路由选择协议用于自动地设置转发表。  

电路交换：电路交换在端系统通信时预留缓存、链路速率资源，发送方可以确保的恒定速率向接收方传送数据，传统电话网称建立的连接为电路。分组交换不预留资源，当有分组正在被传输时，其他分组可能需要排队等待接入通信线路。  

电路交换网络中主机A向主机B通信：  
每条链路有4条电路，两台主机创建一条专用的端到端连接，该连接获得链路总传输容量的1/4。如果两台临近交换机之间每条链路具有1Mbps传输速率，则每个端到端电路交换机获得250kbps专用的传输速率。  

电路交换频分复用FDM：链路中的电路通过频分复用FDM或时分复用TDM实现。在FDM中，链路为每条连接专用一个频段。电话网络中带宽即频段宽度常为4kHz即每秒4000周期；调频无线电台使用FDM来共享88MHz~108MHz的频谱。  

TDM：时间分为等期间帧，帧分为等数量时隙。每个连接每帧循环占用指定时隙传输数据。一条电路的传输速率等于帧速率乘以一个时隙中的比特数量。链路每秒传8000个帧，每个时隙有8比特，则电路的传输速率为64kbps。  
主机A向主机B传送640000比特的文件，使用具有24时隙TDM，比特速率为1.536Mbps，创建端到端电路需要500ms；每条链路的传输速率为1.536Mbps/24=64kbps，640kb/64kbps=10s，总共10.5s发送该文件。电路交换的传输时间与链路数量无关。  

分组交换比电路交换更有效：电路交换在静默期的资源不能被其他连接所使用，打电话的人未说话时空闲链路资源不能利用。  
多用户共享一条1Mbps链路，某用户10%时间活跃，产生数据速率0~100kbps。电路交换，必须为每个用户预留100kbps，只能支持10个并发用户；对电路交换TDM，1秒的帧被划分为10个100ms的时隙，每帧为每个用户分配一个时隙。分组交换，如果有35个用户，有11或更多并发活跃用户的概率约0.0004，有10个或更少活跃并发用户概率约0.9996；当有10个或更少用户时，分组交换没有时延与电路交换一样，超越10个用户时，分组到达的聚合数据速率超过链路的输出容量，输出队列变长，直到聚合输入速率重新低于1Mbps，队列变短；超过10个活跃并发用户的概率极低，用户数达3倍也是如此，因此分组交换的性能与电路交换相当。  
10个用户中，9个静默，1个用户突然产生1000个1000比特的分组。对电路交换TDM，每帧10个时隙，每个时隙1000比特，活跃用户只能使用1/10的时隙传输数据，传输完所有10^6比特需要10秒。对分组交换，活跃用户能够以1Mbps全部链路速率发送分组，全部发送需要1秒。  

网络的网络：接入ISP被认为是客户，全球ISP是提供商。网络结构1，单一的全球ISP。网络结构2，多个全球ISP。网络结构3，多个区域ISP与第一ISP。网络结构4，存在点PoP、多宿、对等、因特网交换点。网络结构5，在网络结构4顶部增加内容提供商，可以和较低层ISP直接互联。网络的网络，十多个第一层ISP和数十万个较低层ISP组成，较低层ISP与较高层相连，高层ISP彼此互联，用户和内容提供商是较低层ISP的客户，较低层ISP是较高层ISP的客户。  

存在点PoP：PoP存在于除了接入ISP以外的等级结构所有层次。一个PoP是提供商网络中的一或多台路由器，客户ISP能够与提供商ISP连接，客户通过电信提供商租用高速链路将其连接到PoP的一台路由器。多宿，任何除了第一层ISP可以选择与两个及以上提供商ISP相连，一个接入ISP可以和两个区域ISP多宿，也可以和一个第一层ISP多宿，多宿的ISP其提供商之一故障仍可继续收发分组。对等，位于同级结构层次的一对ISP能够对等，对等ISP的流量经直接连接而不通过上游传输，对等ISP不进行费用结算。因特网交换点IXP，IXP是一个汇合点，多个ISP在这里一起对等。  

时延：处理时延：检查首部，决定分组出链，检查差错等，微秒量级。排队时延：取决于先前到达分组的在缓存队列流量，毫秒到微秒量级。传输时延：分组长L比特，链路传输速率为Rbps，传输时延L/R，毫秒到微秒量级。传播时延：取决于物理媒体，2 * 10^8~3 * 10^8 m/s，传播时延等于路由器间距除以传播速率d/s，广域网中毫秒量级。  
传输时延与传播时延：传输时延为路由器发送分组时间L/R，传播时延是路由器间距的函数d/s。  
$d_{nodal}节点总时延 =d_{proc}处理+d_{queue}排队+d_{trans}传输+d_{prop}传播$  
$d_{proc}$ 通常是微不足道的，但对路由器最大吞吐量有重要影响。吞吐量是一台路由器能够转发分组的最大速率。  
$d_{trans}$ = L/R 对于10Mbps及更高传输速率信道如LAN可能是微不足道的，对于低速调制解调器链路发送的长因特网分组，可能数百毫秒。  
$d_{prop}$ 对于两台位于同一大学的路由器可能是微不足道的，对于同步卫星链路互联的路由器，$d_{prop}$ 是数百毫秒。  

$d_{queue}$ 排队时延：每个分组L比特，传输速率为Rbps，分组到达队列的平均速率为a分组/秒即a pkt/s，比特到达队列的平均速率为La bps，流量强度为La/R。设计系统时流量强度不能大于1，La/R>1时队列趋于无限增加。La/R $\leq$ 1时，流量强度影响排队时延。若分组周期性到达，每L/R秒到达一个分组，每个分组到达一个空队列中，不会有排队时延。若分组以突发形式到达，每N(L/R)秒同时到达N个分组，则第一个分组没有排队时延，第二个分组有L/R秒排队时延，第n个分组有(n-1)L/R秒的排队时延，实际情况到达队列过程随机。  

丢包：流量强度La/R接近于1时，排队时延事实不会趋于无穷，路由器会丢弃分组，分组丢失比例随着流量强度增加而增加。丢包的分组可能基于端到端的原则重传，以确保所有的数据最终从源传到了目的。  

端到端时延：源到目的的主机有N-1台路由器，$d_{end-end}=N(d_{proc}+d_{trans}+d_{prop})$=N(d_{proc}+L/R+d_{prop})$源向目的发送N个分组，经过N-1个路由器，当第n台路由器接收到第n个分组时，路由器向源回送一个报文，目的主机接收到第n个分组时，也向源回送一个报文。源记录了发送报文和收到回传报文的时间，也记录了返回报文路由器的名字和地址，源以此能重建从源到目的所采路由，且能确定到中间路由器的往返时延。分组n发送到路由器的往返时延可能比分组n+1的往返时延更长。  

吞吐量：主机A向主机B传送大文件，瞬时吞吐量是主机B接收到文件的速率bps计。文件有F比特，主机B接收用去T秒，文件传送的平均吞吐量为F/T bps。客户和服务器由两条通信链路和一台路由器相连，服务器传送一个文件到客户，$R_{s}$ 为服务器与路由器的链路速率，$R_{c}$ 为路由器与客户的链路速率，理想情况下吞吐量为min{$R_{c}$,$R_{s}$}，称瓶颈链路的传输速率，则服务器传送大文件到客户需要的时间为F/min{$R_{c}$,$R_{s}$}。N条链路的传输速率为$R_{1}$,$R_{2}$,...,$R_{n}$，链路的传输吞吐量为吞吐量为min{$R_{1}$,$R_{2}$,...,$R_{n}$}，是服务器和客户端路径的瓶颈链路速率。互联网中对吞吐量的限制因素通常是接入网。  
10个客户-服务器对，核心中有一条10个下载通过的链路速率为R，服务器接入速率为 $R_{s}$，客户接入速率为 $R_{c}$。当R远远大于 $R_{s}$ 和 $R_{c}$ 时，下载吞吐量为min{$R_{c}$,$R_{s}$}。当R与 $R_{s}$ 和 $R_{c}$ 具有同一量级时，下载瓶颈不再位于接入网而位于核心中的共享链路。$R_{s}$=2Mbps，$R_{c}$=1Mbps，R=5Mbps，公共链路为10个下载平均划分传输速率，每个提供500kbps，因此端到端吞吐量减少到500kbps，此例说明吞吐量不仅取决于链路传输速率，还取决于干扰流量。  

协议分层：一个协议层能够通过软硬件结合来实现，第n层协议分布在构成网络的端系统、分组交换机和其他组件中。分层协议的优点是概念化、结构化，缺点是可能冗余较低层的功能，以及某层功能需要仅在其他层才出现的信息，违背分离层次目标。各层的所有协议被称为协议栈，因特网为5层协议栈，物理层、链路层、网络层、运输层、应用层。  

应用层：应用层分组称为报文（message）。Web文档HTTP、电子邮件SMTP、端系统文件FTP、域名系统DNS。  
运输层：运输层分组称为报文段（segment）。面向连接服务TCP，服务包括了应用层报文向目的确保传递和流量控制即速率匹配，将长报文划分为短报文，提供拥塞控制机制，网路拥塞时一直源传输速率；无连接服务UDP，不可靠，物流量控制、拥塞控制。  
网络层：网络层的分组称为数据报（datatgram）。网际IP协议、路由选择协议。网络层简单称为IP层。  
链路层：链路层分组称为帧（frame）。网络层的数据报通过路由器路由，将分组从一个节点传到另一个节点，网络层还需依靠链路层的服务。在每个节点，网络层将数据报下传给链路层，链路层将数据报传送给下一个节点，并上传给网络层。链路层提供节点到节点的可靠传递，不同于TCP端到端的可靠交付。以太网、WiFi、电缆接入网的DOCSIS协议都是链路层协议。一个数据报从源到目的经过多个链路，可能被不同的链路层协议处理，网络层将受到来自链路层的不同服务。  
物理层：链路层将整个帧从节点到节点移动，物理层将帧中的比特从节点到节点移动。协议仍然是链路层相关的，进一步与实际传输媒体相关，双绞线、同轴电缆、光纤。   

开放系统互联OSI模型：物理层、数据链路层、网络层、运输层、会话层、表示层、应用层。表示层，使通信的应用程序能够解释交换数据的含义，服务包括数据压缩和数据描述。会话层，提供了数据交换的界定和同步功能，包括建立检查点和恢复方案的方法。  

封装：数据从发送端协议栈向下，沿着中间链路层交换机和路由器协议栈上上下下，到达接收端协议栈。分组交换机并不实现所有层次协议栈，路由器实现了第一到三层物理、链路、网络层，链路交换机实现了第一第二层物理、链路，主机实现所有5层。应用层报文传给运输层，应用层报文加上运输层首部信息构成运输层报文段，运输层报文段传给网络层，运输层报文段加上网络层首部信息构成网络层数据报，网络层数据报传给链路层，网络层数据报加上链路层首部信息构成链路层帧。分组=首部字段+有效载荷字段，有效载荷字段来自上一层的分组。实际封装更为复杂，打包问可能被划分为多个运输层报文段，在接收端，需要从连续的数据报中重构报文段。  

网络攻击：受害主机统称为僵尸网络，攻击者利用僵尸网络控制对主机目标开展垃圾邮件分发和分布式拒绝服务攻击。多数恶意软件是自我复制的，恶意软件能够以病毒或者蠕虫形式扩散。病毒需要用户交互来感染用户设备，蠕虫不需要显式用户交互就能进入设备。  

拒绝服务攻击DoS：DoS攻击使得网络、主机、其他基础设施不能被合法用户使用。DoS分为弱点攻击、带宽洪泛、连接洪泛。弱点攻击：以适当顺序向易受攻击的应用程序或操作系统发送制作精细的报文，导致服务器停止、主机崩溃。带宽洪泛：攻击者向主机发送大量分组，使接入链路拥塞，合法的分组无法到达服务器。连接洪泛：攻击者在目标主机中创建大量半开或全开的TCP连接，主机因伪造的连接陷入困境，并停止接收合法的连接。  

DoS带宽洪泛攻击：服务器接入速率为Rbps，攻击者需要Rbps的速率产生危害，如果R非常大，单一攻击源可能无法产生足够大的流量来伤害该服务器，若单一源发出所有流量，则上游路由器就能够检测出攻击并在该流量靠近服务器之前就将其阻挡下来。分布式DDoS，攻击者控制多个受害主机组成的僵尸网络向目标猛烈发送流量。  

嗅探分组：在无线传输设备附近放置一台被动的接收机即分组嗅探器，该接收机就能得到传输的每个分组的副本。分组嗅探器也能够部署在有线广播环境中，如LAN，电缆接入技术也广播分组，攻击者获得机构与因特网的接入路由器或接入访问权就可以放置一台嗅探器以获得分组的副本，进行离线解析，提取敏感信息。  

IP哄骗：攻击者生成具有任意源地址、分组内容、目的地址的分组，传入到因特网，接收方如路由器将其作为真实地址，执行嵌入在该分组中的命令如修改转发表。端点鉴别机制用于确保一个报文来自可靠的地方。  

因特网历史：分组交换机的发展1961~1972，专用网络互连1972~1980，网络的激增1980~1990，因特网爆炸20世纪90年代，新近发展。  







